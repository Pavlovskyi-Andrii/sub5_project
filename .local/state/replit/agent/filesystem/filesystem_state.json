{"file_contents":{"replit.md":{"content":"# Garmin Connect to Google Sheets Sync\n\n## Overview\nThis Python script automates the synchronization of training data from Garmin Connect to Google Sheets. It is designed for athletes who want to collect and analyze their training data in a convenient and structured format, specifically catering to triathlon metrics. The project aims to provide detailed insights into training performance by integrating key metrics like power, cadence, pace, and heart rate directly into a customizable spreadsheet.\n\n## User Preferences\n- –Ø–∑—ã–∫: –†—É—Å—Å–∫–∏–π\n- –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö: —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø–æ–ª—è –¥–ª—è —Ç—Ä–∏–∞—Ç–ª–æ–Ω–∞ (–≤–∞—Ç—ã, –∫–∞–¥–µ–Ω—Å, —Ç–µ–º–ø –∏ —Ç.–¥.)\n- –¢—Ä–µ–±—É—é—Ç—Å—è –ø–æ–ª—è –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Å—É–±—ä–µ–∫—Ç–∏–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö\n\n## System Architecture\nThe system is built around a `main.py` script that orchestrates data flow between Garmin Connect and Google Sheets.\n-   **UI/UX Decisions:** The project integrates with an existing Google Sheet structure that includes specific rows for training blocks (e.g., \"–õ–æ–Ω–≥ RUN (–≤—Å)\", \"–°—Ç–∞–Ω–æ–≤–∞—è + –ø–ª–∞–≤–∞–Ω—å–µ (–ø–Ω)\") and dedicated cells for various metrics. Data is formatted without units (e.g., \"5.91\" instead of \"5.91 –∫–º\") to maintain consistency.\n-   **Technical Implementations:**\n    -   **Garmin Connect Integration:** Utilizes the `garminconnect` library for authentication (with session caching) and data retrieval.\n    -   **Google Sheets Integration:** Employs `gspread` and `oauth2client` for secure interaction with Google Sheets via a Service Account.\n    -   **Data Processing:** Includes functions for parsing dates from specific block rows, calculating weekly totals for cycling and running, and safely extracting metrics from activity data.\n    -   **Optimization:** A `BatchUpdater` class is used to consolidate multiple cell updates into single batch requests, minimizing API quota consumption. Date reading is also optimized using `batch_get`.\n    -   **Data Mapping:** Specific logic handles the mapping of Garmin activity data to predefined cells in the Google Sheet for various training types (bike, run, strength, swim), including special handling for combined Saturday activities (bike + brick run).\n    -   **Data Conversion:** Handles conversions for pace (m/s to min/km), time (seconds to HH:MM:SS), and speed (m/s to km/h).\n-   **Feature Specifications:**\n    -   Automated synchronization of training data (bike, run, strength, swim).\n    -   Extraction of key metrics: average watts, Normalized Power, speed, cadence, heart rate, distance, pace, and HRV (planned).\n    -   Dynamic identification of training block rows and corresponding dates.\n    -   Calculation of weekly distance and time totals for cycling and running.\n    -   Error handling and informative logging.\n    -   Secure credential management via environment variables.\n\n## External Dependencies\n-   **Garmin Connect API:** Used for fetching user activity data.\n-   **Google Sheets API:** Used for reading from and writing to Google Spreadsheets.\n-   **Google Cloud Platform:** Required for managing API access and Service Account credentials.\n-   `garminconnect` library: Python wrapper for Garmin Connect.\n-   `gspread` library: Python client for Google Sheets API.\n-   `oauth2client` library: OAuth2 client for Google APIs.\n-   `python-dotenv` library: For loading environment variables.","size_bytes":3418},"pyproject.toml":{"content":"[project]\nname = \"repl-nix-workspace\"\nversion = \"0.1.0\"\ndescription = \"Add your description here\"\nrequires-python = \">=3.11\"\ndependencies = [\n    \"garminconnect>=0.2.30\",\n    \"google-auth>=2.41.1\",\n    \"gspread>=6.2.1\",\n    \"oauth2client>=4.1.3\",\n    \"python-dotenv>=1.1.1\",\n]\n","size_bytes":277},"README.md":{"content":"# Garmin Connect to Google Sheets Sync\n\n–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –∏–∑ Garmin Connect –≤ Google –¢–∞–±–ª–∏—Ü—ã \"–í–ï–õ –ë–ï–ì\".\n\n## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏\n\n- üìä –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –∏–∑ Garmin Connect\n- üö¥ –í–µ–ª–æ—Å–∏–ø–µ–¥–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏: –≤–∞—Ç—ã, Normalized Power, —Å–∫–æ—Ä–æ—Å—Ç—å, –∫–∞–¥–µ–Ω—Å, –ß–°–°\n- üèÉ –ë–µ–≥–æ–≤—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏: –≤—Ä–µ–º—è, —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ, —Ç–µ–º–ø, –ß–°–°\n- üìà –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–ø–∏—Å—å –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –ø–æ –Ω–µ–¥–µ–ª—è–º\n- üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö\n- ‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è API –∑–∞–ø—Ä–æ—Å–æ–≤ —á–µ—Ä–µ–∑ batch operations\n- üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è –≤—ã–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –ª–∏—Å—Ç \"–∏—Å—Ö–æ–¥–Ω–∏–∫\"\n\n## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã \"–í–ï–õ –ë–ï–ì\"\n\n–¢–∞–±–ª–∏—Ü–∞ –∏–º–µ–µ—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å –±–ª–æ–∫–∞–º–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –ø–æ –¥–Ω—è–º –Ω–µ–¥–µ–ª–∏:\n\n### –°—É–±–±–æ—Ç–∞ (—Å—Ç—Ä–æ–∫–∏ 7-15) - –í–µ–ª –¥–ª–∏–Ω–Ω–∞—è + –±–µ–≥ –±—Ä–∏–∫\n- **–°—Ç—Ä–æ–∫–∏ 7-11**: –º–µ—Ç—Ä–∏–∫–∏ –≤–µ–ª–æ—Å–∏–ø–µ–¥–∞ (—á–µ—Ä–µ–∑ \"/\" –µ—Å–ª–∏ 2 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏)\n  - –°—Ä–µ–¥–Ω–∏–µ –≤–∞—Ç—ã\n  - Normalized Power\n  - –°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å (–∫–º/—á)\n  - –ß–∞—Å—Ç–æ—Ç–∞ –≤—Ä–∞—â–µ–Ω–∏—è (–∫–∞–¥–µ–Ω—Å)\n  - –°—Ä–µ–¥–Ω—è—è –ß–°–°\n- **–°—Ç—Ä–æ–∫–∏ 13-15**: –º–µ—Ç—Ä–∏–∫–∏ –±–µ–≥–∞ –±—Ä–∏–∫\n  - –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ (–∫–º)\n  - –¢–µ–º–ø (–º–∏–Ω/–∫–º)\n  - –ß–°–°\n\n### –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ (—Å—Ç—Ä–æ–∫–∞ 20+) - –õ–æ–Ω–≥ RUN\n- –í—Ä–µ–º—è, —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ, —Ç–µ–º–ø, –ß–°–°\n\n### –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ (—Å—Ç—Ä–æ–∫–∞ 33+) - –°—Ç–∞–Ω–æ–≤–∞—è + –ø–ª–∞–≤–∞–Ω–∏–µ\n- –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏\n\n### –í—Ç–æ—Ä–Ω–∏–∫ (—Å—Ç—Ä–æ–∫–∞ 38+) - –ö–æ—Ä–æ—Ç–∫–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã BIKE\n- –í—Ä–µ–º—è, —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ, —Å–∫–æ—Ä–æ—Å—Ç—å, –∫–∞–¥–µ–Ω—Å\n\n### –°—Ä–µ–¥–∞ - –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã –±–µ–≥\n- –í—Ä–µ–º—è, —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ, —Ç–µ–º–ø, –ß–°–°\n\n### –ü—è—Ç–Ω–∏—Ü–∞ (—Å—Ç—Ä–æ–∫–∞ 73+) - –û—Ç–¥—ã—Ö –∏–ª–∏ —Å—É—Ö–æ–µ –ø–ª–∞–≤–∞–Ω–∏–µ\n\n## –ù–∞—Å—Ç—Ä–æ–π–∫–∞\n\n### 1. –°–æ–∑–¥–∞–π—Ç–µ Service Account –≤ Google Cloud\n\n1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [Google Cloud Console](https://console.cloud.google.com/)\n2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π\n3. –í–∫–ª—é—á–∏—Ç–µ Google Sheets API\n4. –°–æ–∑–¥–∞–π—Ç–µ Service Account:\n   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ \"IAM & Admin\" ‚Üí \"Service Accounts\"\n   - –ù–∞–∂–º–∏—Ç–µ \"Create Service Account\"\n   - –î–∞–π—Ç–µ –∏–º—è –∏ —Å–æ–∑–¥–∞–π—Ç–µ\n   - –ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç ‚Üí \"Keys\" ‚Üí \"Add Key\" ‚Üí \"Create New Key\" ‚Üí JSON\n   - –°–∫–∞—á–∞–π—Ç–µ JSON —Ñ–∞–π–ª\n\n### 2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Google –¢–∞–±–ª–∏—Ü—É\n\n1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à—É —Ç–∞–±–ª–∏—Ü—É \"–í–ï–õ –ë–ï–ì\"\n2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ URL —Ç–∞–±–ª–∏—Ü—ã\n3. –û—Ç–∫—Ä–æ–π—Ç–µ JSON —Ñ–∞–π–ª service account –∏ –Ω–∞–π–¥–∏—Ç–µ email (–Ω–∞–ø—Ä–∏–º–µ—Ä: `xxx@xxx.iam.gserviceaccount.com`)\n4. –ü–æ–¥–µ–ª–∏—Ç–µ—Å—å —Ç–∞–±–ª–∏—Ü–µ–π —Å —ç—Ç–∏–º email (–¥–∞–π—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)\n\n### 3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Replit\n\n–î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ Replit Secrets:\n\n- `GARMIN_EMAIL` - –≤–∞—à email –æ—Ç Garmin Connect\n- `GARMIN_PASSWORD` - –≤–∞—à –ø–∞—Ä–æ–ª—å –æ—Ç Garmin Connect\n- `GOOGLE_SHEET_URL` - URL –≤–∞—à–µ–π Google –¢–∞–±–ª–∏—Ü—ã\n- `SERVICE_ACCOUNT_JSON` - —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ JSON —Ñ–∞–π–ª–∞ service account (–≤–µ—Å—å —Ç–µ–∫—Å—Ç)\n- `DAYS_TO_SYNC` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 7)\n\n### 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç\n\n–°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ Workflow \"Garmin Sync\" –∏–ª–∏ –≤—Ä—É—á–Ω—É—é:\n\n```bash\npython main.py\n```\n\n## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã\n\n### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–µ–¥–µ–ª—å\n- –°–∫—Ä–∏–ø—Ç —á–∏—Ç–∞–µ—Ç –¥–∞—Ç—ã –∏–∑ —Å—Ç—Ä–æ–∫ –±–ª–æ–∫–æ–≤ (20, 33, 38, 73) –≤–º–µ—Å—Ç–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞\n- –ö–∞–∂–¥–∞—è –Ω–µ–¥–µ–ª—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å —Å—É–±–±–æ—Ç—ã\n- –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ø–∞–¥–∞—é—Ç –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å—Ç–æ–ª–±–µ—Ü\n\n### –ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö\n- –ï—Å–ª–∏ –≤ –æ–¥–∏–Ω –¥–µ–Ω—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–µ–ª–æ—Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ - –º–µ—Ç—Ä–∏–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ \"/\" (–Ω–∞–ø—Ä–∏–º–µ—Ä: 164/146)\n- –î–ª—è –±–µ–≥–∞ –≤—Å–µ–≥–¥–∞ –±–µ—Ä–µ—Ç—Å—è –ø–µ—Ä–≤–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –¥–Ω—è\n\n### –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ\n- –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –ë–ï–ó –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ —á–∏—Å–ª–∞)\n- –¢–µ–º–ø –±–µ–≥–∞: \"5:07\" –≤–º–µ—Å—Ç–æ \"5:07 /–∫–º\"\n- –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: \"23.31\" –≤–º–µ—Å—Ç–æ \"23.31 –∫–º\"\n- –ß–°–°: \"159\" –≤–º–µ—Å—Ç–æ \"159 —É–¥./–º–∏–Ω\"\n\n### –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞\n–î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –º–æ–∂–Ω–æ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ `main.py` —Ñ—É–Ω–∫—Ü–∏—é `export_all_data_to_source()`:\n\n```python\n# –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —ç—Ç—É —Å—Ç—Ä–æ–∫—É –¥–ª—è –≤—ã–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö\nexport_all_data_to_source(garmin, sheet)\n```\n\n–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç –ª–∏—Å—Ç \"–∏—Å—Ö–æ–¥–Ω–∏–∫\" —Å–æ –≤—Å–µ–º–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ Garmin –∑–∞ –ø–µ—Ä–∏–æ–¥ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏.\n\n## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º\n\n### –û—à–∏–±–∫–∞ \"401 Unauthorized\" –ø—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Garmin\n\n1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**\n   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `GARMIN_EMAIL` –∏ `GARMIN_PASSWORD` —É–∫–∞–∑–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ\n   - –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤–æ–π—Ç–∏ –Ω–∞ [connect.garmin.com](https://connect.garmin.com) –≤ –±—Ä–∞—É–∑–µ—Ä–µ\n\n2. **–î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (2FA):**\n   - –ï—Å–ª–∏ —É –≤–∞—Å –≤–∫–ª—é—á–µ–Ω–∞ 2FA, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Å–µ—Å—Å–∏—é (—Å–º. –Ω–∏–∂–µ)\n\n3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Å–µ—Å—Å–∏—é (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è):**\n   - –ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞ —Å–∫—Ä–∏–ø—Ç –≤—ã–≤–µ–¥–µ—Ç `SESSION_SECRET`\n   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –∏ –¥–æ–±–∞–≤—å—Ç–µ –µ–≥–æ –≤ Replit Secrets –∫–∞–∫ `SESSION_SECRET`\n   - –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –∏–∑–±–µ–∂–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏\n\n### –ü—Ä–æ–±–ª–µ–º—ã —Å Google Sheets\n\n1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –ø–æ–¥–µ–ª–∏–ª–∏—Å—å —Ç–∞–±–ª–∏—Ü–µ–π —Å email –∏–∑ Service Account\n2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `SERVICE_ACCOUNT_JSON` —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–Ω—ã–π JSON\n3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Google Sheets API –≤–∫–ª—é—á–µ–Ω –≤ Google Cloud Console\n4. –ï—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∞ –∫–≤–æ—Ç–∞ API - –ø–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç (—Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç batch_update –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏)\n\n## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è\n\n- –°–∫—Ä–∏–ø—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç –í–°–ï –Ω–µ–¥–µ–ª–∏ –∑–∞ `DAYS_TO_SYNC` –¥–Ω–µ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 7)\n- –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ —Ç—Ä–µ–±—É–µ—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ Garmin, –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—É—é —Å–µ—Å—Å–∏—é\n- BatchUpdater –∫–ª–∞—Å—Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç API –∑–∞–ø—Ä–æ—Å—ã –∫ Google Sheets\n- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫: –≤–µ–ª–æ—Å–∏–ø–µ–¥, –±–µ–≥, —Å–∏–ª–æ–≤–∞—è, –ø–ª–∞–≤–∞–Ω–∏–µ\n- –î–∞—Ç—ã –ø–∞—Ä—Å—è—Ç—Å—è –∏–∑ —Å—Ç—Ä–æ–∫ –±–ª–æ–∫–æ–≤ (20, 33, 38, 73) —á–µ—Ä–µ–∑ batch_get –∑–∞–ø—Ä–æ—Å\n","size_bytes":7542},"main.py":{"content":"#!/usr/bin/env python3\nimport os\nimport json\nimport re\nfrom datetime import datetime, timedelta\nfrom garminconnect import Garmin\nimport gspread\nfrom google.oauth2.service_account import Credentials\nfrom dotenv import load_dotenv\n\n\nload_dotenv()\n\ndef connect_to_garmin():\n    \"\"\"–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Garmin Connect\"\"\"\n    email = os.getenv('GARMIN_EMAIL')\n    password = os.getenv('GARMIN_PASSWORD')\n    session_data = os.getenv('SESSION_SECRET')\n    \n    if not email or not password:\n        raise ValueError(\"Garmin credentials not found. Please set GARMIN_EMAIL and GARMIN_PASSWORD\")\n    \n    print(\"Connecting to Garmin Connect...\")\n    \n    try:\n        client = Garmin(email, password)\n        \n        if session_data:\n            try:\n                print(\"Attempting to use saved session...\")\n                client.garth.loads(session_data)\n                test_date = datetime.today().strftime(\"%Y-%m-%d\")\n                client.get_user_summary(test_date)\n                print(\"‚úì Successfully connected using saved session!\")\n                return client\n            except Exception as e:\n                print(f\"Saved session invalid, logging in again... ({str(e)})\")\n        \n        print(\"Logging in with credentials (this may take a moment)...\")\n        client.login()\n        \n        try:\n            token_data = client.garth.dumps()\n            print(f\"\\n{'='*60}\")\n            print(f\"‚úì Login successful!\")\n            print(f\"{'='*60}\")\n            print(f\"\\nIMPORTANT: To avoid re-logging in every time, add this to your Secrets:\")\n            print(f\"SESSION_SECRET = {token_data[:80]}...\")\n            print(f\"(Full token data has been saved, copy from logs if needed)\")\n            print(f\"{'='*60}\\n\")\n        except Exception as e:\n            print(f\"Warning: Could not save session data: {str(e)}\")\n        \n        print(\"Successfully connected to Garmin!\")\n        return client\n        \n    except Exception as e:\n        error_msg = str(e)\n        if \"401\" in error_msg or \"Unauthorized\" in error_msg:\n            raise ValueError(\n                \"\\n\" + \"=\"*60 + \"\\n\"\n                \"‚ùå Garmin authentication failed!\\n\"\n                \"=\"*60 + \"\\n\"\n                \"Possible solutions:\\n\"\n                \"1. Double-check GARMIN_EMAIL and GARMIN_PASSWORD are correct\\n\"\n                \"2. Try logging into connect.garmin.com in your browser first\\n\"\n                \"3. If you have 2FA/MFA enabled, you may need to disable it temporarily\\n\"\n                \"4. Wait a few minutes and try again (rate limiting)\\n\"\n                \"5. Check if your account is locked or requires verification\\n\"\n                f\"\\nError details: {error_msg}\\n\"\n                \"=\"*60\n            )\n        raise\n\ndef connect_to_google_sheets():\n    \"\"\"–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets\"\"\"\n    spreadsheet_url = os.getenv('GOOGLE_SHEET_URL')\n    \n    if not spreadsheet_url:\n        raise ValueError(\"Google Sheet URL not found. Please set GOOGLE_SHEET_URL\")\n    \n    scopes = [\n        'https://www.googleapis.com/auth/spreadsheets',\n        'https://www.googleapis.com/auth/drive'\n    ]\n    \n    service_account_json = os.getenv('SERVICE_ACCOUNT_JSON')\n    \n    if service_account_json:\n        creds_dict = json.loads(service_account_json)\n        service_account_email = creds_dict.get('client_email', 'UNKNOWN')\n        creds = Credentials.from_service_account_info(creds_dict, scopes=scopes)\n        print(\"Connecting to Google Sheets with service account...\")\n    else:\n        print(\"Error: SERVICE_ACCOUNT_JSON not found in environment variables\")\n        raise ValueError(\"SERVICE_ACCOUNT_JSON is required\")\n    \n    client = gspread.authorize(creds)\n    \n    try:\n        sheet = client.open_by_url(spreadsheet_url)\n        print(f\"‚úì Successfully connected to Google Sheet!\")\n        return sheet\n    except PermissionError:\n        print(\"\\n\" + \"=\"*60)\n        print(\"‚ùå –û–®–ò–ë–ö–ê –î–û–°–¢–£–ü–ê –ö GOOGLE –¢–ê–ë–õ–ò–¶–ï\")\n        print(\"=\"*60)\n        print(f\"\\n–í–∞–º –Ω—É–∂–Ω–æ –¥–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Ç–∞–±–ª–∏—Ü–µ –¥–ª—è Service Account!\")\n        print(f\"\\n1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É: {spreadsheet_url}\")\n        print(f\"2. –ù–∞–∂–º–∏—Ç–µ '–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–æ—Å—Ç—É–ø' (Share)\")\n        print(f\"3. –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ—Ç email —Å –ø—Ä–∞–≤–∞–º–∏ '–†–µ–¥–∞–∫—Ç–æ—Ä':\")\n        print(f\"\\n   {service_account_email}\")\n        print(f\"\\n4. –ù–∞–∂–º–∏—Ç–µ '–ì–æ—Ç–æ–≤–æ' –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç —Å–Ω–æ–≤–∞\")\n        print(\"=\"*60 + \"\\n\")\n        raise\n\ndef parse_date(date_str):\n    \"\"\"–ü–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç—ã –∏–∑ —Ç–∞–±–ª–∏—Ü—ã –≤ —Ñ–æ—Ä–º–∞—Ç datetime —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π regex\"\"\"\n    import re\n    \n    if not date_str:\n        return None\n    \n    # –ò—â–µ–º –ø–µ—Ä–≤—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω –¥–∞—Ç—ã –≤–∏–¥–∞ DD.MM –∏–ª–∏ DD.MM.YY –∏–ª–∏ DD.MM.YYYY\n    match = re.search(r'(\\d{1,2})\\.(\\d{1,2})(?:\\.(\\d{2,4}))?', date_str)\n    \n    if match:\n        try:\n            day = int(match.group(1))\n            month = int(match.group(2))\n            year_str = match.group(3)\n            \n            if year_str:\n                year = int(year_str)\n                if year < 100:\n                    year += 2000\n            else:\n                year = datetime.now().year\n            \n            return datetime(year, month, day)\n        except:\n            pass\n    \n    return None\n\ndef format_time(seconds):\n    \"\"\"–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∏–∑ —Å–µ–∫—É–Ω–¥ –≤ –ß–ß:–ú–ú:–°–°\"\"\"\n    if not seconds:\n        return ''\n    hours = int(seconds // 3600)\n    minutes = int((seconds % 3600) // 60)\n    secs = int(seconds % 60)\n    return f\"{hours}:{minutes:02d}:{secs:02d}\"\n\ndef format_pace(speed_mps):\n    \"\"\"–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–º–ø–∞ –∏–∑ –º/—Å –≤ –º–∏–Ω/–∫–º\"\"\"\n    if not speed_mps or speed_mps == 0:\n        return ''\n    pace_min_per_km = 1000 / (speed_mps * 60)\n    minutes = int(pace_min_per_km)\n    seconds = int((pace_min_per_km - minutes) * 60)\n    return f\"{minutes}:{seconds:02d}\"\n\ndef get_activities_for_date(garmin_client, target_date):\n    \"\"\"–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∑–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –¥–∞—Ç—É\"\"\"\n    # –ü–æ–ª—É—á–∞–µ–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∑–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å\n    activities = garmin_client.get_activities(0, 50)  # –ë–µ—Ä–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫\n    \n    # –ï—Å–ª–∏ target_date - datetime, –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ date\n    if hasattr(target_date, 'date'):\n        target_date = target_date.date()\n    \n    result = []\n    for activity in activities:\n        start_time_str = activity.get('startTimeLocal', '')\n        if start_time_str:\n            activity_date = datetime.strptime(start_time_str.split()[0], '%Y-%m-%d').date()\n            if activity_date == target_date:\n                result.append(activity)\n    \n    return result\n\ndef get_training_blocks(worksheet):\n    \"\"\"–ù–∞–π—Ç–∏ –≤—Å–µ –±–ª–æ–∫–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –≤ —Ç–∞–±–ª–∏—Ü–µ\"\"\"\n    # –¢–µ–ø–µ—Ä—å —Å—Ç–æ–ª–±–µ—Ü B (2) —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞–∑–≤–∞–Ω–∏—è –±–ª–æ–∫–æ–≤, —Å—Ç–æ–ª–±–µ—Ü A - –ø–æ—Ä—è–¥–∫–æ–≤—ã–µ –Ω–æ–º–µ—Ä–∞\n    col_b = worksheet.col_values(2)\n    \n    blocks = []\n    for row_num, value in enumerate(col_b, 1):\n        if not value:\n            continue\n        value = str(value).strip()\n        # –ò—â–µ–º —Å—Ç—Ä–æ–∫–∏ —Å –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫\n        if value and any(keyword in value.upper() for keyword in ['RUN', 'BIKE', '–ë–ï–ì', '–í–ï–õ', '–ü–õ–ê–í', 'FTP', '–î–õ–ò–ù']):\n            # –ß–∏—Ç–∞–µ–º —Å—Ç—Ä–æ–∫—É —Å –¥–∞—Ç–∞–º–∏\n            row_data = worksheet.row_values(row_num)\n            blocks.append({\n                'row': row_num,\n                'name': value,\n                'data': row_data\n            })\n    \n    return blocks\n\ndef process_cycling_data(garmin_client, activities):\n    \"\"\"–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤–µ–ª–æ—Å–∏–ø–µ–¥–∞\"\"\"\n    if not activities:\n        return {}\n    \n    data = {\n        'avg_power': [],\n        'normalized_power': [],\n        'avg_speed': [],\n        'avg_cadence': [],\n        'avg_hr': []\n    }\n    \n    for activity in activities:\n        activity_id = activity['activityId']\n        details = garmin_client.get_activity(activity_id)\n        summary = details.get('summaryDTO', {})\n        \n        avg_power = summary.get('averagePower', '')\n        normalized_power = summary.get('normalizedPower', '')\n        avg_speed = round(summary.get('averageSpeed', 0) * 3.6, 1) if summary.get('averageSpeed') else ''\n        avg_cadence = summary.get('averageBikeCadence', '')\n        avg_hr = summary.get('averageHR', '')\n        \n        if avg_power:\n            data['avg_power'].append(str(int(avg_power)))\n        if normalized_power:\n            data['normalized_power'].append(str(int(normalized_power)))\n        if avg_speed:\n            data['avg_speed'].append(str(avg_speed))\n        if avg_cadence:\n            data['avg_cadence'].append(str(int(avg_cadence)))\n        if avg_hr:\n            data['avg_hr'].append(str(int(avg_hr)))\n    \n    return data\n\ndef process_running_data(garmin_client, activity):\n    \"\"\"–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –±–µ–≥–∞\"\"\"\n    if not activity:\n        return {}\n    \n    activity_id = activity['activityId']\n    details = garmin_client.get_activity(activity_id)\n    summary = details.get('summaryDTO', {})\n    \n    duration = format_time(summary.get('duration', 0))\n    distance = round(summary.get('distance', 0) / 1000, 2) if summary.get('distance') else ''\n    avg_speed = summary.get('averageSpeed', 0)\n    avg_pace = format_pace(avg_speed) if avg_speed else ''\n    avg_hr = summary.get('averageHR', '')\n    \n    return {\n        'time': duration,\n        'distance': f\"{distance} –∫–º\" if distance else '',\n        'pace': avg_pace if avg_pace else '',\n        'hr': f\"{int(avg_hr)} —É–¥./–º–∏–Ω\" if avg_hr else ''\n    }\n\nclass BatchUpdater:\n    \"\"\"–ö–ª–∞—Å—Å –¥–ª—è –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ batch –∑–∞–ø—Ä–æ—Å–æ–º\"\"\"\n    def __init__(self, worksheet):\n        self.worksheet = worksheet\n        self.updates = []\n    \n    def add_update(self, row, col, value):\n        \"\"\"–î–æ–±–∞–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ –æ—á–µ—Ä–µ–¥—å\"\"\"\n        self.updates.append({\n            'row': row,\n            'col': col,\n            'value': str(value) if value else ''\n        })\n    \n    def flush(self):\n        \"\"\"–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º\"\"\"\n        if not self.updates:\n            return\n        \n        # –§–æ—Ä–º–∏—Ä—É–µ–º batch_update –∑–∞–ø—Ä–æ—Å\n        cells_to_update = []\n        for update in self.updates:\n            cell = gspread.utils.rowcol_to_a1(update['row'], update['col'])\n            cells_to_update.append({\n                'range': cell,\n                'values': [[update['value']]]\n            })\n        \n        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º batch update\n        if cells_to_update:\n            self.worksheet.batch_update(cells_to_update, value_input_option='USER_ENTERED')\n        \n        self.updates = []\n\ndef calculate_weekly_totals(garmin_client, week_activities, sunday_date, batch, col_index):\n    \"\"\"–ü–æ–¥—Å—á–µ—Ç –Ω–µ–¥–µ–ª—å–Ω—ã—Ö –∏—Ç–æ–≥–æ–≤ –¥–ª—è –≤–µ–ª–æ—Å–∏–ø–µ–¥–∞ –∏ –±–µ–≥–∞\n    \n    Args:\n        garmin_client: –ö–ª–∏–µ–Ω—Ç Garmin\n        week_activities: –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π –Ω–µ–¥–µ–ª–∏\n        sunday_date: –î–∞—Ç–∞ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å—è (–∫–æ–Ω–µ—Ü –Ω–µ–¥–µ–ª–∏ –∏–∑ —Å—Ç—Ä–æ–∫–∏ 20)\n        batch: BatchUpdater –¥–ª—è –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö\n        col_index: –ò–Ω–¥–µ–∫—Å —Å—Ç–æ–ª–±—Ü–∞\n    \"\"\"\n    if not sunday_date or not week_activities:\n        return\n    \n    # –ù–µ–¥–µ–ª—è: –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ - –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ (–ø–Ω-–≤—Å)\n    # –ï—Å–ª–∏ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ = 19.10, —Ç–æ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ = 19.10 - 6 –¥–Ω–µ–π = 13.10\n    monday_date = sunday_date - timedelta(days=6)\n    \n    print(f\"\\nüìä –ü–æ–¥—Å—á–µ—Ç –Ω–µ–¥–µ–ª—å–Ω—ã—Ö –∏—Ç–æ–≥–æ–≤ (–ø–Ω-–≤—Å: {monday_date.strftime('%d.%m')} - {sunday_date.strftime('%d.%m')})...\")\n    \n    # –§–∏–ª—å—Ç—Ä—É–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –Ω–µ–¥–µ–ª–∏ (–ø–Ω-–≤—Å)\n    week_filtered_activities = []\n    for activity in week_activities:\n        start_time_str = activity.get('startTimeLocal', '')\n        if start_time_str:\n            activity_date = datetime.strptime(start_time_str.split()[0], '%Y-%m-%d').date()\n            if monday_date <= activity_date <= sunday_date:\n                week_filtered_activities.append(activity)\n    \n    # –†–∞–∑–¥–µ–ª—è–µ–º –ø–æ —Ç–∏–ø–∞–º\n    cycling_activities = [a for a in week_filtered_activities if 'cycling' in a.get('activityType', {}).get('typeKey', '').lower()]\n    running_activities = [a for a in week_filtered_activities if 'running' in a.get('activityType', {}).get('typeKey', '').lower()]\n    \n    # –í–ï–õ–û–°–ò–ü–ï–î\n    total_cycling_distance = 0  # –≤ –∫–º\n    total_cycling_time = 0  # –≤ —Å–µ–∫—É–Ω–¥–∞—Ö\n    \n    for activity in cycling_activities:\n        distance = activity.get('distance')\n        if distance:\n            total_cycling_distance += distance / 1000  # –º–µ—Ç—Ä—ã -> –∫–º\n        \n        duration = activity.get('duration')\n        if duration:\n            total_cycling_time += duration\n    \n    # –ë–ï–ì–ê\n    total_running_distance = 0  # –≤ –∫–º\n    total_running_time = 0  # –≤ —Å–µ–∫—É–Ω–¥–∞—Ö\n    sunday_long_run_hrv = None\n    \n    # –ò—â–µ–º –≤–æ—Å–∫—Ä–µ—Å–Ω—ã–µ –±–µ–≥–æ–≤—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –¥–ª—è HRV\n    sunday_runs = []\n    for activity in running_activities:\n        start_time_str = activity.get('startTimeLocal', '')\n        if start_time_str:\n            activity_date = datetime.strptime(start_time_str.split()[0], '%Y-%m-%d').date()\n            if activity_date == sunday_date:\n                sunday_runs.append(activity)\n    \n    for activity in running_activities:\n        distance = activity.get('distance')\n        if distance:\n            total_running_distance += distance / 1000  # –º–µ—Ç—Ä—ã -> –∫–º\n        \n        duration = activity.get('duration')\n        if duration:\n            total_running_time += duration\n    \n    # –ò–∑–≤–ª–µ–∫–∞–µ–º HRV –∏–∑ –≤–æ—Å–∫—Ä–µ—Å–Ω–æ–π Long Run\n    if sunday_runs:\n        # –ë–µ—Ä–µ–º –ø–µ—Ä–≤—É—é (–∏–ª–∏ —Å–∞–º—É—é –¥–ª–∏–Ω–Ω—É—é) —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å—è\n        long_run = sunday_runs[0]\n        activity_id = long_run.get('activityId')\n        \n        if activity_id:\n            try:\n                # –ü–æ–ª—É—á–∞–µ–º –¥–µ—Ç–∞–ª–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏\n                details = garmin_client.get_activity_details(activity_id)\n                # HRV –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª—è—Ö\n                sunday_long_run_hrv = details.get('averageHeartRateVariability') or details.get('hrv')\n            except:\n                pass\n    \n    # –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ\n    # –°—Ç—Ä–æ–∫–∞ 18: TVD dist (Bike) - –Ω–µ–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ–µ–∑–¥ –≤ –∫–º\n    if total_cycling_distance > 0:\n        cycling_dist_str = f\"{total_cycling_distance:.2f}\"\n        batch.add_update(18, col_index + 1, cycling_dist_str)\n        print(f\"  ‚úì TVD dist (Bike): {cycling_dist_str} –∫–º ‚Üí —Å—Ç—Ä–æ–∫–∞ 18\")\n    \n    # –°—Ç—Ä–æ–∫–∞ 19: TVT time (Bike) - —Ñ–æ—Ä–º–∞—Ç –ß–ß:–ú–ú –∏–ª–∏ –ú–ú:–°–°\n    if total_cycling_time > 0:\n        hours = int(total_cycling_time // 3600)\n        minutes = int((total_cycling_time % 3600) // 60)\n        if hours > 0:\n            cycling_time_str = f\"{hours}:{minutes:02d}\"\n        else:\n            seconds = int(total_cycling_time % 60)\n            cycling_time_str = f\"{minutes}:{seconds:02d}\"\n        batch.add_update(19, col_index + 1, cycling_time_str)\n        print(f\"  ‚úì TVT time (Bike): {cycling_time_str} ‚Üí —Å—Ç—Ä–æ–∫–∞ 19\")\n    \n    # –°—Ç—Ä–æ–∫–∞ 29: TVD dist RUN - –Ω–µ–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ–±–µ–≥ –≤ –∫–º\n    if total_running_distance > 0:\n        running_dist_str = f\"{total_running_distance:.2f}\"\n        batch.add_update(29, col_index + 1, running_dist_str)\n        print(f\"  ‚úì TVD dist RUN: {running_dist_str} –∫–º ‚Üí —Å—Ç—Ä–æ–∫–∞ 29\")\n    \n    # –°—Ç—Ä–æ–∫–∞ 30: TVT time RUN\n    if total_running_time > 0:\n        hours = int(total_running_time // 3600)\n        minutes = int((total_running_time % 3600) // 60)\n        if hours > 0:\n            running_time_str = f\"{hours}:{minutes:02d}\"\n        else:\n            seconds = int(total_running_time % 60)\n            running_time_str = f\"{minutes}:{seconds:02d}\"\n        batch.add_update(30, col_index + 1, running_time_str)\n        print(f\"  ‚úì TVT time RUN: {running_time_str} ‚Üí —Å—Ç—Ä–æ–∫–∞ 30\")\n    \n    # –°—Ç—Ä–æ–∫–∞ 31: –≤–∞—Ä–∏–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –°–† –∏–∑ Long Run (–≤—Å)\n    if sunday_long_run_hrv:\n        batch.add_update(31, col_index + 1, sunday_long_run_hrv)\n        print(f\"  ‚úì –í–∞—Ä–∏–∞–±–µ–ª—å–Ω–æ—Å—Ç—å –°–† (HRV): {sunday_long_run_hrv} ‚Üí —Å—Ç—Ä–æ–∫–∞ 31\")\n    \n    print(f\"  üìà –ò—Ç–æ–≥–æ –≤–µ–ª: {total_cycling_distance:.2f} –∫–º, –±–µ–≥: {total_running_distance:.2f} –∫–º\")\n\ndef sync_to_sheet(garmin_client, worksheet, column, week_start_date=None, training_blocks=None, week_activities=None):\n    \"\"\"–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å—Ç–æ–ª–±–µ—Ü\n    \n    Args:\n        garmin_client: –ö–ª–∏–µ–Ω—Ç Garmin\n        worksheet: –õ–∏—Å—Ç Google Sheets\n        column: –°—Ç–æ–ª–±–µ—Ü –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (A, B, C –∏ —Ç.–¥.)\n        week_start_date: –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –Ω–µ–¥–µ–ª–∏ (—Å—É–±–±–æ—Ç–∞), –¥–ª—è –±–ª–æ–∫–æ–≤ –±–µ–∑ –¥–∞—Ç—ã\n        training_blocks: –°–ø–∏—Å–æ–∫ –±–ª–æ–∫–æ–≤ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ (–¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ API)\n        week_activities: –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π –Ω–µ–¥–µ–ª–∏ (–¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ API)\n    \"\"\"\n    print(f\"\\n{'='*60}\")\n    print(f\"–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–ª—è —Å—Ç–æ–ª–±—Ü–∞ {column}\")\n    print(f\"{'='*60}\")\n    \n    # –°–æ–∑–¥–∞–µ–º batch updater\n    batch = BatchUpdater(worksheet)\n    \n    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∏–Ω–¥–µ–∫—Å –∫–æ–ª–æ–Ω–∫–∏ (E = 5, –∑–Ω–∞—á–∏—Ç –∏–Ω–¥–µ–∫—Å 4)\n    col_index = ord(column.upper()) - ord('A')\n    \n    # –§–ò–ö–°–ò–†–û–í–ê–ù–ù–ê–Ø –û–ë–†–ê–ë–û–¢–ö–ê –°–£–ë–ë–û–¢–´ (—Å—Ç—Ä–æ–∫–∏ 7-15)\n    # –°—É–±–±–æ—Ç–∞ –í–°–ï–ì–î–ê –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –µ—Å–ª–∏ –µ—Å—Ç—å week_start_date\n    if week_start_date:\n        print(f\"\\nüìÖ –°—É–±–±–æ—Ç–∞ (–í–µ–ª –¥–ª–∏–Ω–Ω–∞—è + –±–µ–≥ –±—Ä–∏–∫) - {week_start_date.strftime('%d.%m.%y')}\")\n        \n        # –ü–æ–ª—É—á–∞–µ–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∑–∞ —Å—É–±–±–æ—Ç—É\n        saturday_activities = get_activities_for_date(garmin_client, week_start_date)\n        \n        if saturday_activities:\n            # –†–∞–∑–¥–µ–ª—è–µ–º –ø–æ —Ç–∏–ø–∞–º\n            cycling_activities = [a for a in saturday_activities if 'cycling' in a.get('activityType', {}).get('typeKey', '').lower()]\n            running_activities = [a for a in saturday_activities if 'running' in a.get('activityType', {}).get('typeKey', '').lower()]\n            \n            print(f\"  üö¥ –í–µ–ª–æ—Å–∏–ø–µ–¥: {len(cycling_activities)} —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫\")\n            print(f\"  üèÉ –ë–µ–≥: {len(running_activities)} —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫\")\n            \n            # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–µ–ª–æ—Å–∏–ø–µ–¥ (—Å—Ç—Ä–æ–∫–∏ 7-11)\n            if cycling_activities:\n                cycle_data = process_cycling_data(garmin_client, cycling_activities[:2])\n                \n                def format_values(values_list):\n                    if len(values_list) >= 2:\n                        return f\"{values_list[0]}/{values_list[1]}\"\n                    elif len(values_list) == 1:\n                        return values_list[0]\n                    return ''\n                \n                # –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –¥–ª–∏–Ω—ã —Å–ø–∏—Å–∫–æ–≤\n                def safe_get(data_list, index):\n                    return data_list[index] if index < len(data_list) else None\n                \n                avg_power_list = cycle_data.get('avg_power', [])\n                np_power_list = cycle_data.get('normalized_power', [])\n                speed_list = cycle_data.get('avg_speed', [])\n                cadence_list = cycle_data.get('avg_cadence', [])\n                hr_list = cycle_data.get('avg_hr', [])\n                \n                avg_power = format_values([safe_get(avg_power_list, i) for i in range(min(2, len(cycling_activities)))])\n                np_power = format_values([safe_get(np_power_list, i) for i in range(min(2, len(cycling_activities)))])\n                speed = format_values([safe_get(speed_list, i) for i in range(min(2, len(cycling_activities)))])\n                cadence = format_values([safe_get(cadence_list, i) for i in range(min(2, len(cycling_activities)))])\n                hr = format_values([safe_get(hr_list, i) for i in range(min(2, len(cycling_activities)))])\n                \n                if avg_power:\n                    batch.add_update(7, col_index + 1, avg_power)\n                    print(f\"  ‚úì –°—Ä–µ–¥–Ω–∏–µ –≤–∞—Ç—ã: {avg_power} ‚Üí {column}7\")\n                if np_power:\n                    batch.add_update(8, col_index + 1, np_power)\n                    print(f\"  ‚úì Normalized Power: {np_power} ‚Üí {column}8\")\n                if speed:\n                    batch.add_update(9, col_index + 1, speed)\n                    print(f\"  ‚úì –°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å: {speed} ‚Üí {column}9\")\n                if cadence:\n                    batch.add_update(10, col_index + 1, cadence)\n                    print(f\"  ‚úì –ß–∞—Å—Ç–æ—Ç–∞ –≤—Ä–∞—â–µ–Ω–∏—è: {cadence} ‚Üí {column}10\")\n                if hr:\n                    batch.add_update(11, col_index + 1, hr)\n                    print(f\"  ‚úì –°—Ä–µ–¥–Ω—è—è –ß–°–°: {hr} ‚Üí {column}11\")\n            \n            # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –±–µ–≥ –±—Ä–∏–∫ (—Å—Ç—Ä–æ–∫–∏ 13-15)\n            if running_activities:\n                run = running_activities[0]\n                distance = run.get('distance', 0)\n                if distance:\n                    distance_km = round(distance / 1000, 2)\n                    batch.add_update(13, col_index + 1, str(distance_km))\n                    print(f\"  ‚úì –ë–µ–≥ –±—Ä–∏–∫ –∫–º: {distance_km} ‚Üí {column}13\")\n                \n                avg_speed = run.get('averageSpeed')\n                if avg_speed:\n                    pace_str = format_pace(avg_speed)\n                    if pace_str:\n                        batch.add_update(14, col_index + 1, pace_str)\n                        print(f\"  ‚úì –ë–µ–≥ –±—Ä–∏–∫ —Ç–µ–º–ø: {pace_str} ‚Üí {column}14\")\n                \n                avg_hr = run.get('averageHR')\n                if avg_hr:\n                    batch.add_update(15, col_index + 1, str(int(avg_hr)))\n                    print(f\"  ‚úì –ë–µ–≥ –±—Ä–∏–∫ –ß–°–°: {int(avg_hr)} ‚Üí {column}15\")\n        else:\n            print(f\"  ‚ÑπÔ∏è  –ù–µ—Ç —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –∑–∞ —Å—É–±–±–æ—Ç—É {week_start_date.strftime('%d.%m.%y')}\")\n    \n    # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –±–ª–æ–∫–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –∏–ª–∏ –ø–æ–ª—É—á–∞–µ–º –∏—Ö (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)\n    blocks = training_blocks if training_blocks is not None else get_training_blocks(worksheet)\n    \n    # –î–ª—è –∫–∞–∂–¥–æ–≥–æ –±–ª–æ–∫–∞ –∏—â–µ–º –¥–∞—Ç—É –≤ –Ω—É–∂–Ω–æ–º —Å—Ç–æ–ª–±—Ü–µ\n    for block in blocks:\n        row_num = block['row']\n        name = block['name']\n        row_data = block['data']\n        \n        # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –±–ª–æ–∫ —Å—É–±–±–æ—Ç—ã (—Å—Ç—Ä–æ–∫–∏ 6-15) - –æ–Ω —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ª–æ–≥–∏–∫–æ–π\n        if 6 <= row_num <= 15:\n            continue\n        \n        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∏–Ω–¥–µ–∫—Å –∫–æ–ª–æ–Ω–∫–∏\n        if col_index >= len(row_data):\n            continue\n        \n        date_str = row_data[col_index]\n        date_obj = parse_date(date_str)\n        \n        # –°–ü–ï–¶–ò–ê–õ–¨–ù–ê–Ø –õ–û–ì–ò–ö–ê –î–õ–Ø –°–£–ë–ë–û–¢–´: –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞—Ç—É –Ω–∞—á–∞–ª–∞ –Ω–µ–¥–µ–ª–∏\n        if not date_obj and '—Å–±' in name.lower() and week_start_date:\n            date_obj = week_start_date\n            print(f\"üìÖ {name} - {date_obj.strftime('%d.%m.%y')} (–Ω–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏)\")\n        \n        # –ï—Å–ª–∏ –≤ —Å—Ç—Ä–æ–∫–µ –±–ª–æ–∫–∞ –Ω–µ—Ç –¥–∞—Ç—ã, –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä–æ–∫—É 1 (–∑–∞–≥–æ–ª–æ–≤–∫–∏ –Ω–µ–¥–µ–ª—å) - —É—Å—Ç–∞—Ä–µ–≤—à–∞—è –ª–æ–≥–∏–∫–∞\n        elif not date_obj:\n            row1 = worksheet.row_values(1)\n            if col_index < len(row1):\n                date_str = row1[col_index]\n                date_obj = parse_date(date_str)\n        \n        if not date_obj:\n            continue\n        \n        print(f\"\\nüìÖ {name} - {date_str}\")\n        \n        # –ü–æ–ª—É—á–∞–µ–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∑–∞ —ç—Ç—É –¥–∞—Ç—É\n        activities = get_activities_for_date(garmin_client, date_obj)\n        \n        if not activities:\n            print(f\"  ‚ÑπÔ∏è  –ù–µ—Ç —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –≤ Garmin –∑–∞ {date_str}\")\n            continue\n        \n        # –†–∞–∑–¥–µ–ª—è–µ–º –ø–æ —Ç–∏–ø–∞–º\n        cycling_activities = [a for a in activities if 'cycling' in a.get('activityType', {}).get('typeKey', '').lower()]\n        running_activities = [a for a in activities if 'running' in a.get('activityType', {}).get('typeKey', '').lower()]\n        strength_activities = [a for a in activities if 'strength' in a.get('activityType', {}).get('typeKey', '').lower()]\n        swimming_activities = [a for a in activities if 'swimming' in a.get('activityType', {}).get('typeKey', '').lower() or 'lap_swimming' in a.get('activityType', {}).get('typeKey', '').lower()]\n        \n        print(f\"  üö¥ –í–µ–ª–æ—Å–∏–ø–µ–¥: {len(cycling_activities)} —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫\")\n        print(f\"  üèÉ –ë–µ–≥: {len(running_activities)} —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫\")\n        print(f\"  üí™ –°–∏–ª–æ–≤–∞—è: {len(strength_activities)} —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫\")\n        print(f\"  üèä –ü–ª–∞–≤–∞–Ω–∏–µ: {len(swimming_activities)} —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫\")\n        \n        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫—É–¥–∞ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ\n        # –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–ª–æ–∫–∏ (–≤–µ–ª+–±–µ–≥, –Ω–∞–ø—Ä–∏–º–µ—Ä —Å—É–±–±–æ—Ç–∞)\n        if ('–í–ï–õ' in name.upper() or 'BIKE' in name.upper()) and ('–ë–ï–ì' in name.upper() or 'RUN' in name.upper()):\n            # –≠—Ç–æ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–ª–æ–∫ (—Å—É–±–±–æ—Ç–∞: 2 –≤–µ–ª + 1 –±–µ–≥)\n            # –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ 7-15\n            \n            # –°–Ω–∞—á–∞–ª–∞ –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –≤–µ–ª–æ—Å–∏–ø–µ–¥ (—Å—Ç—Ä–æ–∫–∏ 7-11)\n            if cycling_activities:\n                cycle_data = process_cycling_data(garmin_client, cycling_activities[:2])\n                \n                def format_values(values_list):\n                    if len(values_list) >= 2:\n                        return f\"{values_list[0]}/{values_list[1]}\"\n                    elif len(values_list) == 1:\n                        return values_list[0]\n                    return ''\n                \n                avg_power_str = format_values(cycle_data['avg_power'])\n                np_str = format_values(cycle_data['normalized_power'])\n                speed_str = format_values(cycle_data['avg_speed'])\n                cadence_str = format_values(cycle_data['avg_cadence'])\n                hr_str = format_values(cycle_data['avg_hr'])\n                \n                print(f\"  üìä –î–∞–Ω–Ω—ã–µ –≤–µ–ª: power={avg_power_str}, NP={np_str}, speed={speed_str}, cadence={cadence_str}, HR={hr_str}\")\n                \n                # –°—Ç—Ä–æ–∫–∞ 7: –°—Ä–µ–¥–Ω–∏–µ –≤–∞—Ç—ã\n                if avg_power_str:\n                    batch.add_update(7, col_index + 1, avg_power_str)\n                    print(f\"  ‚úì –°—Ä–µ–¥–Ω–∏–µ –≤–∞—Ç—ã: {avg_power_str} ‚Üí {chr(64+col_index+1)}7\")\n                \n                # –°—Ç—Ä–æ–∫–∞ 8: Normalized Power\n                if np_str:\n                    batch.add_update(8, col_index + 1, np_str)\n                    print(f\"  ‚úì Normalized Power: {np_str} ‚Üí {chr(64+col_index+1)}8\")\n                \n                # –°—Ç—Ä–æ–∫–∞ 9: –°—Ä–µ–¥.—Å–∫–æ—Ä–æ—Å—Ç—å\n                if speed_str:\n                    batch.add_update(9, col_index + 1, speed_str)\n                    print(f\"  ‚úì –°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å: {speed_str} ‚Üí {chr(64+col_index+1)}9\")\n                \n                # –°—Ç—Ä–æ–∫–∞ 10: –ß–∞—Å—Ç–æ—Ç–∞ –≤—Ä–∞—â–µ–Ω–∏—è\n                if cadence_str:\n                    batch.add_update(10, col_index + 1, cadence_str)\n                    print(f\"  ‚úì –ß–∞—Å—Ç–æ—Ç–∞ –≤—Ä–∞—â–µ–Ω–∏—è: {cadence_str} ‚Üí {chr(64+col_index+1)}10\")\n                \n                # –°—Ç—Ä–æ–∫–∞ 11: –°—Ä–µ–¥–Ω—è—è –ß–°–°\n                if hr_str:\n                    batch.add_update(11, col_index + 1, hr_str)\n                    print(f\"  ‚úì –°—Ä–µ–¥–Ω—è—è –ß–°–°: {hr_str} ‚Üí {chr(64+col_index+1)}11\")\n            \n            # –ü–æ—Ç–æ–º –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –±–µ–≥ –±—Ä–∏–∫ (—Å—Ç—Ä–æ–∫–∏ 13-15)\n            if running_activities:\n                run_data = process_running_data(garmin_client, running_activities[0])\n                \n                # –°—Ç—Ä–æ–∫–∞ 13: –ë–µ–≥ –±—Ä–∏–∫ –∫–º\n                if run_data.get('distance'):\n                    distance_only = run_data['distance'].replace(' –∫–º', '')\n                    batch.add_update(13, col_index + 1, distance_only)\n                    print(f\"  ‚úì –ë–µ–≥ –±—Ä–∏–∫ –∫–º: {distance_only} ‚Üí {chr(64+col_index+1)}13\")\n                \n                # –°—Ç—Ä–æ–∫–∞ 14: –ë–µ–≥ –±—Ä–∏–∫ —Ç–µ–º–ø\n                if run_data.get('pace'):\n                    batch.add_update(14, col_index + 1, run_data['pace'])\n                    print(f\"  ‚úì –ë–µ–≥ –±—Ä–∏–∫ —Ç–µ–º–ø: {run_data['pace']} ‚Üí {chr(64+col_index+1)}14\")\n                \n                # –°—Ç—Ä–æ–∫–∞ 15: –ë–µ–≥ –±—Ä–∏–∫ –ß–°–°\n                if run_data.get('hr'):\n                    hr_only = run_data['hr'].replace(' —É–¥./–º–∏–Ω', '')\n                    batch.add_update(15, col_index + 1, hr_only)\n                    print(f\"  ‚úì –ë–µ–≥ –±—Ä–∏–∫ –ß–°–°: {hr_only} ‚Üí {chr(64+col_index+1)}15\")\n        \n        elif '–ë–ï–ì' in name.upper() or 'RUN' in name.upper():\n            # –≠—Ç–æ –±–ª–æ–∫ –±–µ–≥–∞\n            if running_activities:\n                run_data = process_running_data(garmin_client, running_activities[0])\n                # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ\n                # –°—Ç—Ä–æ–∫–∞ +1 = –í—Ä–µ–º—è, +2 = –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ, +3 = –¢–µ–º–ø, +4 = –ß–°–°\n                if run_data.get('time'):\n                    batch.add_update(row_num + 1, col_index + 1, run_data['time'])\n                if run_data.get('distance'):\n                    distance_only = run_data['distance'].replace(' –∫–º', '')\n                    batch.add_update(row_num + 2, col_index + 1, distance_only)\n                if run_data.get('pace'):\n                    batch.add_update(row_num + 3, col_index + 1, run_data['pace'])\n                if run_data.get('hr'):\n                    hr_only = run_data['hr'].replace(' —É–¥./–º–∏–Ω', '')\n                    batch.add_update(row_num + 4, col_index + 1, hr_only)\n                print(f\"  ‚úì –ó–∞–ø–∏—Å–∞–Ω—ã –¥–∞–Ω–Ω—ã–µ –±–µ–≥–∞\")\n        \n        elif '–í–ï–õ' in name.upper() or 'BIKE' in name.upper() or 'FTP' in name.upper() or ('–ß–¢' in name.upper() and '–î–õ–ò–ù' in name.upper()):\n            # –≠—Ç–æ –±–ª–æ–∫ –≤–µ–ª–æ—Å–∏–ø–µ–¥–∞\n            if cycling_activities:\n                cycle_data = process_cycling_data(garmin_client, cycling_activities[:2])  # –ú–∞–∫—Å 2 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏\n                \n                # –ò—â–µ–º —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤ —Å—Ç–æ–ª–±—Ü–µ B (—Å—Ç–æ–ª–±–µ—Ü A —Ç–µ–ø–µ—Ä—å —Å –Ω–æ–º–µ—Ä–∞–º–∏)\n                col_b = worksheet.col_values(2)\n                \n                # –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ (—á–µ—Ä–µ–∑ —Å–ª–µ—à –µ—Å–ª–∏ 2 —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏)\n                def format_values(values_list):\n                    if len(values_list) >= 2:\n                        return f\"{values_list[0]}/{values_list[1]}\"\n                    elif len(values_list) == 1:\n                        return values_list[0]\n                    return ''\n                \n                avg_power_str = format_values(cycle_data['avg_power'])\n                np_str = format_values(cycle_data['normalized_power'])\n                speed_str = format_values(cycle_data['avg_speed'])\n                cadence_str = format_values(cycle_data['avg_cadence'])\n                hr_str = format_values(cycle_data['avg_hr'])\n                \n                print(f\"  üìä –î–∞–Ω–Ω—ã–µ –≤–µ–ª: power={avg_power_str}, NP={np_str}, speed={speed_str}, cadence={cadence_str}, HR={hr_str}\")\n                \n                # –ò—â–µ–º —Å—Ç—Ä–æ–∫–∏ –ø–æ —Ç–µ–∫—Å—Ç—É –≤ –∫–æ–ª–æ–Ω–∫–µ B (—Ç–æ–ª—å–∫–æ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –±–ª–æ–∫–∞)\n                # row_num - —ç—Ç–æ —É–∂–µ 1-based –∏–Ω–¥–µ–∫—Å –∏–∑ enumerate\n                # col_b - —ç—Ç–æ —Å–ø–∏—Å–æ–∫ —Å–æ —Å—Ç—Ä–æ–∫–∞–º–∏, –∏–Ω–¥–µ–∫—Å—ã —Å 0\n                \n                # –ù–∞—Ö–æ–¥–∏–º –∫–æ–Ω–µ—Ü –±–ª–æ–∫–∞ (—Å–ª–µ–¥—É—é—â–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ –±–ª–æ–∫–∞ –∏–ª–∏ –∫–æ–Ω–µ—Ü —Ç–∞–±–ª–∏—Ü—ã)\n                block_end = len(col_b)\n                for next_idx in range(row_num, len(col_b)):\n                    next_text = str(col_b[next_idx]).strip().upper() if next_idx < len(col_b) else ''\n                    if next_text and any(kw in next_text for kw in ['RUN', 'BIKE', '–ë–ï–ì', '–í–ï–õ', '–ü–õ–ê–í']):\n                        # –≠—Ç–æ —Å–ª–µ–¥—É—é—â–∏–π –±–ª–æ–∫\n                        block_end = next_idx\n                        break\n                \n                print(f\"  üîç –ò—â–µ–º —Å row {row_num} –¥–æ {block_end}\")\n                \n                for search_idx in range(row_num - 1, min(block_end, len(col_b))):\n                    cell_text = str(col_b[search_idx]).strip().lower() if search_idx < len(col_b) else ''\n                    actual_row = search_idx + 1  # –†–µ–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä —Å—Ç—Ä–æ–∫–∏ –≤ Google Sheets\n                    \n                    # –î–ª—è –≤—Ç–æ—Ä–Ω–∏–∫–∞/—á–µ—Ç–≤–µ—Ä–≥–∞: –í—Ä–µ–º—è, –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ, –°—Ä–µ–¥–Ω–∏–π —Ç–µ–º–ø (=—Å–∫–æ—Ä–æ—Å—Ç—å –¥–ª—è –≤–µ–ª–∞), –°—Ä–µ–¥–Ω—è—è –ß–ü\n                    # –ê–≥—Ä–µ–≥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ —Å–ª–µ—à –µ—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ (–∫–∞–∫ –¥–ª—è –º–æ—â–Ω–æ—Å—Ç–∏)\n                    if '–≤—Ä–µ–º' in cell_text and '–¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç' not in cell_text:\n                        # –í—Ä–µ–º—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ (–∞–≥—Ä–µ–≥–∞—Ü–∏—è)\n                        if cycling_activities:\n                            times = [format_time(act.get('duration', 0)) for act in cycling_activities[:2]]\n                            times = [t for t in times if t]\n                            if times:\n                                time_str = '/'.join(times) if len(times) > 1 else times[0]\n                                batch.add_update(actual_row, col_index + 1, time_str)\n                                print(f\"  ‚úì –í—Ä–µ–º—è: {time_str} ‚Üí {chr(64+col_index+1)}{actual_row}\")\n                    \n                    elif '—Ä–∞—Å—Å—Ç–æ—è–Ω' in cell_text:\n                        # –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ (–∞–≥—Ä–µ–≥–∞—Ü–∏—è)\n                        if cycling_activities:\n                            distances = []\n                            for act in cycling_activities[:2]:\n                                dist = act.get('distance', 0)\n                                if dist:\n                                    distances.append(str(round(dist / 1000, 2)))\n                            if distances:\n                                dist_str = '/'.join(distances) if len(distances) > 1 else distances[0]\n                                batch.add_update(actual_row, col_index + 1, dist_str)\n                                print(f\"  ‚úì –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ: {dist_str} –∫–º ‚Üí {chr(64+col_index+1)}{actual_row}\")\n                    \n                    elif '—Å—Ä–µ–¥–Ω' in cell_text and '—Ç–µ–º–ø' in cell_text:\n                        # –°—Ä–µ–¥–Ω–∏–π —Ç–µ–º–ø –¥–ª—è –≤–µ–ª–æ = —Å–∫–æ—Ä–æ—Å—Ç—å (—É–∂–µ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–æ)\n                        if speed_str:\n                            batch.add_update(actual_row, col_index + 1, speed_str)\n                            print(f\"  ‚úì –°—Ä–µ–¥–Ω–∏–π —Ç–µ–º–ø (—Å–∫–æ—Ä–æ—Å—Ç—å): {speed_str} –∫–º/—á ‚Üí {chr(64+col_index+1)}{actual_row}\")\n                    \n                    elif '—Å—Ä–µ–¥–Ω' in cell_text and '–≤–∞—Ç' in cell_text:\n                        if avg_power_str:\n                            batch.add_update(actual_row, col_index + 1, avg_power_str)\n                            print(f\"  ‚úì –°—Ä–µ–¥–Ω–∏–µ –≤–∞—Ç—ã: {avg_power_str} ‚Üí {chr(64+col_index+1)}{actual_row}\")\n                    \n                    elif 'normalized' in cell_text or ('power' in cell_text and 'norm' in cell_text):\n                        if np_str:\n                            batch.add_update(actual_row, col_index + 1, np_str)\n                            print(f\"  ‚úì Normalized Power: {np_str} ‚Üí {chr(64+col_index+1)}{actual_row}\")\n                    \n                    elif '—Å—Ä–µ–¥' in cell_text and '—Å–∫–æ—Ä' in cell_text:\n                        if speed_str:\n                            batch.add_update(actual_row, col_index + 1, speed_str)\n                            print(f\"  ‚úì –°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å: {speed_str} ‚Üí {chr(64+col_index+1)}{actual_row}\")\n                    \n                    elif '—á–∞—Å—Ç–æ—Ç' in cell_text and '–≤—Ä–∞—â' in cell_text:\n                        if cadence_str:\n                            batch.add_update(actual_row, col_index + 1, cadence_str)\n                            print(f\"  ‚úì –ß–∞—Å—Ç–æ—Ç–∞ –≤—Ä–∞—â–µ–Ω–∏—è: {cadence_str} ‚Üí {chr(64+col_index+1)}{actual_row}\")\n                    \n                    # –†–∞–∑–ª–∏—á–∞–µ–º –ß–ü (–∫–∞–¥–µ–Ω—Å) –∏ –ß–°–° (–ø—É–ª—å—Å)\n                    elif ('—Å—Ä–µ–¥–Ω' in cell_text or '—Å—Ä–∞–¥–Ω' in cell_text) and '—á–ø' in cell_text and '—á—Å—Å' not in cell_text:\n                        # –≠—Ç–æ –∫–∞–¥–µ–Ω—Å (–ß–ü = —á–∞—Å—Ç–æ—Ç–∞ –ø–µ–¥–∞–ª–∏—Ä–æ–≤–∞–Ω–∏—è)\n                        if cadence_str:\n                            batch.add_update(actual_row, col_index + 1, cadence_str)\n                            print(f\"  ‚úì –°—Ä–µ–¥–Ω—è—è –ß–ü (–∫–∞–¥–µ–Ω—Å): {cadence_str} ‚Üí {chr(64+col_index+1)}{actual_row}\")\n                    \n                    elif ('—Å—Ä–µ–¥–Ω' in cell_text or '—Å—Ä–∞–¥–Ω' in cell_text) and '—á—Å—Å' in cell_text:\n                        # –≠—Ç–æ –ø—É–ª—å—Å (–ß–°–°)\n                        if hr_str:\n                            batch.add_update(actual_row, col_index + 1, hr_str)\n                            print(f\"  ‚úì –°—Ä–µ–¥–Ω—è—è –ß–°–°: {hr_str} ‚Üí {chr(64+col_index+1)}{actual_row}\")\n        \n        elif ('–°–¢–ê–ù–û–í' in name.upper() or '–ü–õ–ê–í' in name.upper()) and '–ü–ù' in name.upper():\n            # –≠—Ç–æ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ - —Å—Ç–∞–Ω–æ–≤–∞—è + –ø–ª–∞–≤–∞–Ω–∏–µ\n            # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫\n            if strength_activities or swimming_activities:\n                durations = []\n                \n                # –ü–æ–ª—É—á–∞–µ–º –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–∏–ª–æ–≤–æ–π\n                if strength_activities:\n                    activity_id = strength_activities[0]['activityId']\n                    details = garmin_client.get_activity(activity_id)\n                    summary = details.get('summaryDTO', {})\n                    duration_sec = summary.get('duration', 0)\n                    if duration_sec:\n                        hours = int(duration_sec // 3600)\n                        minutes = int((duration_sec % 3600) // 60)\n                        seconds = int(duration_sec % 60)\n                        duration_str = f\"{hours:02d}:{minutes:02d}:{seconds:02d}\"\n                        durations.append(duration_str)\n                \n                # –ü–æ–ª—É—á–∞–µ–º –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–ª–∞–≤–∞–Ω–∏—è\n                if swimming_activities:\n                    activity_id = swimming_activities[0]['activityId']\n                    details = garmin_client.get_activity(activity_id)\n                    summary = details.get('summaryDTO', {})\n                    duration_sec = summary.get('duration', 0)\n                    if duration_sec:\n                        hours = int(duration_sec // 3600)\n                        minutes = int((duration_sec % 3600) // 60)\n                        seconds = int(duration_sec % 60)\n                        duration_str = f\"{hours:02d}:{minutes:02d}:{seconds:02d}\"\n                        durations.append(duration_str)\n                \n                # –ò—â–µ–º —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –∑–∞–ø–∏—Å–∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –±–ª–æ–∫–∞)\n                # –°—Ç–æ–ª–±–µ—Ü B —Ç–µ–ø–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞–∑–≤–∞–Ω–∏—è (—Å—Ç–æ–ª–±–µ—Ü A - –ø–æ—Ä—è–¥–∫–æ–≤—ã–µ –Ω–æ–º–µ—Ä–∞)\n                col_b = worksheet.col_values(2)\n                \n                # –ù–∞—Ö–æ–¥–∏–º –∫–æ–Ω–µ—Ü –±–ª–æ–∫–∞\n                block_end = len(col_b)\n                for next_idx in range(row_num, len(col_b)):\n                    next_text = str(col_b[next_idx]).strip().upper() if next_idx < len(col_b) else ''\n                    if next_text and next_idx > row_num and any(kw in next_text for kw in ['RUN', 'BIKE', '–ë–ï–ì', '–í–ï–õ', '–ü–õ–ê–í', '–õ–û–ù–ì', '–ò–ù–¢–ï–†–í–ê–õ', '–ö–û–†–û–¢–ö–ò–ï', '–î–õ–ò–ù']):\n                        block_end = next_idx\n                        break\n                \n                # –ò—â–µ–º —Å—Ç—Ä–æ–∫–∏ \"–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–µ—Ä–≤–æ–π/–≤—Ç–æ—Ä–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏\"\n                for search_idx in range(row_num - 1, min(block_end, len(col_b))):\n                    cell_text = str(col_b[search_idx]).strip().lower() if search_idx < len(col_b) else ''\n                    actual_row = search_idx + 1\n                    \n                    if '–¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç' in cell_text and '–ø–µ—Ä–≤' in cell_text:\n                        if len(durations) >= 1:\n                            batch.add_update(actual_row, col_index + 1, durations[0])\n                            print(f\"  ‚úì –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–µ—Ä–≤–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏: {durations[0]} ‚Üí {chr(64+col_index+1)}{actual_row}\")\n                    \n                    elif '–¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç' in cell_text and '–≤—Ç–æ—Ä' in cell_text:\n                        if len(durations) >= 2:\n                            batch.add_update(actual_row, col_index + 1, durations[1])\n                            print(f\"  ‚úì –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—Ç–æ—Ä–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏: {durations[1]} ‚Üí {chr(64+col_index+1)}{actual_row}\")\n    \n    # –ü–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ–º –Ω–µ–¥–µ–ª—å–Ω—ã–µ –∏—Ç–æ–≥–∏ (—Å—Ç—Ä–æ–∫–∏ 18, 19, 29, 30, 31)\n    # –ü–∞—Ä–∞–º–µ—Ç—Ä week_start_date –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ —Å–æ–¥–µ—Ä–∂–∏—Ç sunday_date (–∏–∑ —Å—Ç—Ä–æ–∫–∏ 20)\n    if week_activities and week_start_date:\n        calculate_weekly_totals(garmin_client, week_activities, week_start_date, batch, col_index)\n    \n    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤—Å–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ–¥–Ω–∏–º batch –∑–∞–ø—Ä–æ—Å–æ–º\n    batch.flush()\n\ndef get_week_start(date_obj):\n    \"\"\"–ü–æ–ª—É—á–∏—Ç—å —Å—É–±–±–æ—Ç—É –Ω–∞—á–∞–ª–∞ –Ω–µ–¥–µ–ª–∏ –¥–ª—è –¥–∞–Ω–Ω–æ–π –¥–∞—Ç—ã\"\"\"\n    # –ù–µ–¥–µ–ª—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å —Å—É–±–±–æ—Ç—ã (weekday 5)\n    # –ï—Å–ª–∏ —Å–µ–≥–æ–¥–Ω—è —Å—É–±–±–æ—Ç–∞ –∏–ª–∏ –ø–æ–∑–∂–µ - —ç—Ç–æ —Ç–µ–∫—É—â–∞—è –Ω–µ–¥–µ–ª—è\n    # –ï—Å–ª–∏ –¥–æ —Å—É–±–±–æ—Ç—ã - –±–µ—Ä–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—É–±–±–æ—Ç—É\n    days_since_saturday = (date_obj.weekday() + 2) % 7  # –°—É–±–±–æ—Ç–∞ = 0\n    week_start = date_obj - timedelta(days=days_since_saturday)\n    return week_start\n\ndef parse_week_dates_from_block_rows(worksheet):\n    \"\"\"–ü–∞—Ä—Å–∏—Ç –¥–∞—Ç—ã –∏–∑ —Å—Ç—Ä–æ–∫–∏ 20 (–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å—è) –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª–æ–≤–∞—Ä—å {—Å—Ç–æ–ª–±–µ—Ü: –¥–∞—Ç–∞_–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å—è}\"\"\"\n    # –°—Ç—Ä–æ–∫–∞ 20: \"–õ–æ–Ω–≥ RUN (–≤—Å)\" - —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞—Ç—ã –≤–æ—Å–∫—Ä–µ—Å–µ–Ω–∏–π (–∫–æ–Ω–µ—Ü –Ω–µ–¥–µ–ª–∏)\n    try:\n        row_20 = worksheet.row_values(20)\n    except Exception as e:\n        print(f\"‚úó –û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Å—Ç—Ä–æ–∫–∏ 20: {e}\")\n        return {}\n    \n    # –°–ª–æ–≤–∞—Ä—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–æ—Å–∫—Ä–µ—Å–µ–Ω–∏–π –ø–æ —Å—Ç–æ–ª–±—Ü–∞–º: {—Å—Ç–æ–ª–±–µ—Ü: –¥–∞—Ç–∞_–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å—è}\n    sunday_columns = {}\n    \n    # –ü–∞—Ä—Å–∏–º –¥–∞—Ç—ã –≤–æ—Å–∫—Ä–µ—Å–µ–Ω–∏–π\n    for idx, cell in enumerate(row_20):\n        if idx < 2:  # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Ç–æ–ª–±—Ü—ã A –∏ B\n            continue\n        \n        if not cell or not isinstance(cell, str):\n            continue\n        \n        col_letter = chr(65 + idx)  # A, B, C, D, E, F...\n        \n        # –ò—â–µ–º –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ dd.mm.yy\n        date_match = re.search(r'\\b(\\d{2})\\.(\\d{2})\\.(\\d{2})\\b', cell)\n        if date_match:\n            try:\n                day, month, year = date_match.groups()\n                year = '20' + year\n                sunday_date = datetime.strptime(f\"{day}.{month}.{year}\", \"%d.%m.%Y\").date()\n                sunday_columns[col_letter] = sunday_date\n            except:\n                continue\n    \n    return sunday_columns\n\ndef find_column_for_date(activity_date, sunday_columns):\n    \"\"\"–ù–∞—Ö–æ–¥–∏—Ç —Å—Ç–æ–ª–±–µ—Ü –¥–ª—è –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞—Ç—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏\n    \n    –ù–µ–¥–µ–ª—è: –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ - –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ (–ø–Ω-–≤—Å)\n    –ï—Å–ª–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ 15.10, –∞ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ = 19.10, —Ç–æ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ = 13.10\n    –ó–Ω–∞—á–∏—Ç —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ 15.10 –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –Ω–µ–¥–µ–ª—é 13.10-19.10\n    \"\"\"\n    # –ò—â–µ–º –ø–æ–¥—Ö–æ–¥—è—â–∏–π —Å—Ç–æ–ª–±–µ—Ü –ø–æ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å—é\n    for col_letter, sunday_date in sunday_columns.items():\n        # –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ = –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ - 6 –¥–Ω–µ–π\n        monday_date = sunday_date - timedelta(days=6)\n        \n        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ø–∞–¥–∞–µ—Ç –ª–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –≤ –Ω–µ–¥–µ–ª—é –ø–Ω-–≤—Å\n        if monday_date <= activity_date <= sunday_date:\n            return col_letter\n    \n    return None\n\ndef export_all_data_to_source(garmin, sheet):\n    \"\"\"–í—ã–≥—Ä—É–∂–∞–µ—Ç –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –Ω–∞ –ª–∏—Å—Ç '–∏—Å—Ö–æ–¥–Ω–∏–∫' –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏\"\"\"\n    try:\n        # –û—Ç–∫—Ä—ã–≤–∞–µ–º –ª–∏—Å—Ç –∏—Å—Ö–æ–¥–Ω–∏–∫ (–∏–ª–∏ —Å–æ–∑–¥–∞–µ–º –µ—Å–ª–∏ –Ω–µ—Ç)\n        try:\n            worksheet = sheet.worksheet(\"–∏—Å—Ö–æ–¥–Ω–∏–∫\")\n        except:\n            worksheet = sheet.add_worksheet(\"–∏—Å—Ö–æ–¥–Ω–∏–∫\", rows=100, cols=20)\n        \n        print(\"\\n\" + \"=\"*60)\n        print(\"–í—ã–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –ª–∏—Å—Ç '–∏—Å—Ö–æ–¥–Ω–∏–∫'\")\n        print(\"=\"*60)\n        \n        # –ü–æ–ª—É—á–∞–µ–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é\n        days = int(os.getenv('DAYS_TO_SYNC', '7'))\n        activities = garmin.get_activities(0, days * 2)\n        \n        # –û—á–∏—â–∞–µ–º –ª–∏—Å—Ç\n        worksheet.clear()\n        \n        # –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è batch update\n        batch = BatchUpdater(worksheet)\n        row = 1\n        \n        for activity in activities:\n            activity_type = activity.get('activityType', {}).get('typeKey', 'unknown')\n            activity_name = activity.get('activityName', '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')\n            start_time = activity.get('startTimeLocal', '')\n            \n            # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏\n            batch.add_update(row, 1, f\"=== {activity_name} ===\")\n            batch.add_update(row, 2, start_time[:10] if start_time else '')\n            batch.add_update(row, 3, activity_type)\n            print(f\"\\n{activity_name} ({start_time[:10]}) - {activity_type}\")\n            row += 1\n            \n            # –ü–æ–ª—É—á–∞–µ–º –¥–µ—Ç–∞–ª–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏\n            try:\n                activity_id = activity.get('activityId')\n                details = garmin.get_activity(activity_id)\n                summary = details.get('summaryDTO', {})\n                \n                # –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏\n                data_to_export = {\n                    '–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å': format_time(activity.get('duration', 0)),\n                    '–†–∞—Å—Å—Ç–æ—è–Ω–∏–µ (–∫–º)': round(activity.get('distance', 0) / 1000, 2) if activity.get('distance') else None,\n                    '–°—Ä–µ–¥–Ω—è—è —Å–∫–æ—Ä–æ—Å—Ç—å (–∫–º/—á)': round(activity.get('averageSpeed', 0) * 3.6, 1) if activity.get('averageSpeed') else None,\n                    '–°—Ä–µ–¥–Ω—è—è –ß–°–°': summary.get('averageHR'),\n                    '–ö–∞–ª–æ—Ä–∏–∏': activity.get('calories'),\n                }\n                \n                # –î–∞–Ω–Ω—ã–µ –≤–µ–ª–æ—Å–∏–ø–µ–¥–∞\n                if 'cycling' in activity_type.lower():\n                    data_to_export.update({\n                        '–°—Ä–µ–¥–Ω—è—è –º–æ—â–Ω–æ—Å—Ç—å (–í—Ç)': summary.get('avgPower'),\n                        'Normalized Power': summary.get('normPower') or summary.get('normalizedPower'),\n                        '–°—Ä–µ–¥–Ω—è—è –∫–∞–¥–µ–Ω—Å': summary.get('avgBikeCadence') or summary.get('averageBikingCadenceInRevPerMinute'),\n                    })\n                \n                # –î–∞–Ω–Ω—ã–µ –±–µ–≥–∞\n                if 'running' in activity_type.lower():\n                    data_to_export.update({\n                        '–°—Ä–µ–¥–Ω–∏–π —Ç–µ–º–ø (–º–∏–Ω/–∫–º)': format_pace(activity.get('averageSpeed')),\n                        '–°—Ä–µ–¥–Ω—è—è –∫–∞–¥–µ–Ω—Å (—à–∞–≥–∏/–º–∏–Ω)': summary.get('averageRunningCadenceInStepsPerMinute'),\n                    })\n                \n                # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ\n                for key, value in data_to_export.items():\n                    if value is not None and value != '':\n                        batch.add_update(row, 1, key)\n                        batch.add_update(row, 2, str(value))\n                        print(f\"  {key}: {value}\")\n                        row += 1\n                \n            except Exception as e:\n                batch.add_update(row, 1, f\"–û—à–∏–±–∫–∞: {str(e)}\")\n                row += 1\n            \n            # –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –º–µ–∂–¥—É —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞–º–∏\n            row += 1\n        \n        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤—Å–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º\n        batch.flush()\n        \n        print(f\"\\n‚úì –í—ã–≥—Ä—É–∂–µ–Ω–æ {len(activities)} —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –Ω–∞ –ª–∏—Å—Ç '–∏—Å—Ö–æ–¥–Ω–∏–∫'\")\n        print(\"=\"*60)\n        \n    except Exception as e:\n        print(f\"‚úó –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–≥—Ä—É–∑–∫–µ: {e}\")\n        import traceback\n        traceback.print_exc()\n\ndef main():\n    try:\n        print(\"=== Garmin to Google Sheets Sync ===\\n\")\n        \n        # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Garmin\n        garmin = connect_to_garmin()\n        \n        # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Google Sheets\n        sheet = connect_to_google_sheets()\n        \n        # –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê: –≤—ã–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –ª–∏—Å—Ç \"–∏—Å—Ö–æ–¥–Ω–∏–∫\" (—Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)\n        # export_all_data_to_source(garmin, sheet)\n        \n        worksheet = sheet.worksheet(\"–í–ï–õ –ë–ï–ì\")\n        print(f\"\\n‚úì Opened worksheet: {worksheet.title}\")\n        \n        # –ü–∞—Ä—Å–∏–º –¥–∞—Ç—ã –Ω–µ–¥–µ–ª—å –∏–∑ —Å—Ç—Ä–æ–∫ –±–ª–æ–∫–æ–≤ (20, 33, 38, 73)\n        week_columns = parse_week_dates_from_block_rows(worksheet)\n        print(f\"‚úì –ù–∞–π–¥–µ–Ω–æ {len(week_columns)} –Ω–µ–¥–µ–ª—å –≤ —Ç–∞–±–ª–∏—Ü–µ\")\n        \n        # –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –Ω–µ–¥–µ–ª–∏\n        print(\"\\nüìÖ –ù–∞–π–¥–µ–Ω–Ω—ã–µ –Ω–µ–¥–µ–ª–∏:\")\n        for col, date in sorted(week_columns.items()):\n            print(f\"  –°—Ç–æ–ª–±–µ—Ü {col}: {date.strftime('%d.%m.%Y')}\")\n        \n        # –ü–æ–ª—É—á–∞–µ–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ N –¥–Ω–µ–π\n        days_to_sync = int(os.getenv('DAYS_TO_SYNC', '14'))  # –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 30 –¥–Ω–µ–π\n        activities = garmin.get_activities(0, days_to_sync * 2)  # –° –∑–∞–ø–∞—Å–æ–º\n        \n        # –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –ø–æ –Ω–µ–¥–µ–ª—è–º\n        print(\"\\nüìä –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –∏–∑ Garmin:\")\n        activities_by_week = {}\n        for activity in activities:\n            start_time = activity.get('startTimeLocal', '')\n            if start_time:\n                activity_date = datetime.strptime(start_time[:10], '%Y-%m-%d').date()\n                activity_name = activity.get('activityName', '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è')\n                print(f\"  {activity_date.strftime('%d.%m.%Y')} - {activity_name}\")\n                \n                column = find_column_for_date(activity_date, week_columns)\n                \n                if column:\n                    if column not in activities_by_week:\n                        activities_by_week[column] = []\n                    activities_by_week[column].append(activity)\n                else:\n                    print(f\"    ‚ö†Ô∏è –ù–µ –Ω–∞–π–¥–µ–Ω —Å—Ç–æ–ª–±–µ—Ü –¥–ª—è –¥–∞—Ç—ã {activity_date.strftime('%d.%m.%Y')}\")\n        \n        # –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –í–°–ï –Ω–µ–¥–µ–ª–∏ —Å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞–º–∏\n        if activities_by_week:\n            # –ü–æ–ª—É—á–∞–µ–º –±–ª–æ–∫–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –û–î–ò–ù –†–ê–ó –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ API\n            training_blocks = get_training_blocks(worksheet)\n            \n            # –°–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–µ–¥–µ–ª–∏ –ø–æ –¥–∞—Ç–µ\n            sorted_columns = sorted(activities_by_week.keys(), key=lambda col: week_columns.get(col, datetime.min.date()))\n            \n            for column in sorted_columns:\n                week_activities = activities_by_week[column]\n                week_date = week_columns.get(column)\n                \n                print(f\"\\n{'='*60}\")\n                if week_date:\n                    print(f\"–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–µ–¥–µ–ª–∏ {column} (–Ω–∞—á–∞–ª–æ: {week_date.strftime('%d.%m.%Y')})\")\n                else:\n                    print(f\"–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –Ω–µ–¥–µ–ª–∏ {column}\")\n                print(f\"–ù–∞–π–¥–µ–Ω–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫: {len(week_activities)}\")\n                print(f\"{'='*60}\")\n                \n                # –ü–µ—Ä–µ–¥–∞–µ–º –¥–∞—Ç—É –Ω–∞—á–∞–ª–∞ –Ω–µ–¥–µ–ª–∏, –±–ª–æ–∫–∏ –∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ API\n                sync_to_sheet(garmin, worksheet, column, week_start_date=week_date, training_blocks=training_blocks, week_activities=week_activities)\n        else:\n            print(\"\\n‚ÑπÔ∏è  –ù–µ—Ç —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏\")\n        \n        print(f\"\\n{'='*60}\")\n        print(\"‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!\")\n        print(f\"{'='*60}\\n\")\n        \n    except Exception as e:\n        print(f\"\\n‚úó Error: {e}\")\n        import traceback\n        traceback.print_exc()\n        raise\n\nif __name__ == \"__main__\":\n    main()\n","size_bytes":55076}},"version":2}